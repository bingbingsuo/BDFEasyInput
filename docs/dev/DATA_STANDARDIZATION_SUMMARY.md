# æ•°æ®æ ‡å‡†åŒ–åŠŸèƒ½æ€»ç»“

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

BDFEasyInput ç°åœ¨æ”¯æŒ**æ•°æ®åˆ†æç»“æœæ ‡å‡†åŒ–**ï¼Œå°†åˆ†æç»“æœè½¬æ¢ä¸ºç»Ÿä¸€ã€ç»“æ„åŒ–çš„æ ¼å¼ï¼Œä¾¿äºï¼š
- **LLM æ¨¡å‹è®­ç»ƒ**ï¼šå‡†å¤‡é«˜è´¨é‡çš„è®­ç»ƒæ•°æ®
- **æ•°æ®å¤ç”¨**ï¼šæ ‡å‡†åŒ–æ ¼å¼ä¾¿äºåç»­åˆ†æå’Œå¤„ç†
- **çŸ¥è¯†ç§¯ç´¯**ï¼šå»ºç«‹å¯æŸ¥è¯¢çš„è®¡ç®—ç»“æœçŸ¥è¯†åº“

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### 1. æ ‡å‡†åŒ–æ•°æ®æ ¼å¼

- âœ… **ç»Ÿä¸€ç»“æ„**ï¼šå®šä¹‰æ ‡å‡†çš„ JSON Schema
- âœ… **å®Œæ•´ä¿¡æ¯**ï¼šåŒ…å«è¾“å…¥ã€æ‰§è¡Œã€åŸå§‹ç»“æœã€åˆ†æç»“æœç­‰å®Œæ•´ä¿¡æ¯
- âœ… **å¯è¿½æº¯æ€§**ï¼šä¿ç•™è®¡ç®—ä¸Šä¸‹æ–‡å’Œå…ƒæ•°æ®
- âœ… **å¯æ‰©å±•æ€§**ï¼šæ”¯æŒæœªæ¥æ·»åŠ æ–°çš„åˆ†æç»´åº¦

### 2. è®­ç»ƒæ•°æ®å‡†å¤‡

- âœ… **ä»»åŠ¡è§„åˆ’è®­ç»ƒæ•°æ®**ï¼šè‡ªç„¶è¯­è¨€ â†’ YAML é…ç½®
- âœ… **ç»“æœåˆ†æè®­ç»ƒæ•°æ®**ï¼šåŸå§‹ç»“æœ â†’ AI åˆ†æ
- âœ… **å¤šç§æ ¼å¼**ï¼šæ”¯æŒ JSONLã€JSONã€Parquet ç­‰æ ¼å¼
- âœ… **æ‰¹é‡å¤„ç†**ï¼šæ”¯æŒå¤§è§„æ¨¡æ•°æ®å¤„ç†

### 3. æ•°æ®ç®¡ç†

- âœ… **æ•°æ®éªŒè¯**ï¼šSchema éªŒè¯ç¡®ä¿æ•°æ®è´¨é‡
- âœ… **æ•°æ®ç´¢å¼•**ï¼šå¿«é€ŸæŸ¥è¯¢å’Œæ£€ç´¢
- âœ… **ç»Ÿè®¡åˆ†æ**ï¼šæ•°æ®ç»Ÿè®¡å’Œå¯è§†åŒ–
- âœ… **æ•°æ®æ¸…æ´—**ï¼šè‡ªåŠ¨å¤„ç†æ— æ•ˆæ•°æ®

## ğŸ“Š æ ‡å‡†åŒ–æ•°æ®æ ¼å¼

### æ ¸å¿ƒç»“æ„

```json
{
  "metadata": {...},        // å…ƒæ•°æ®ï¼ˆç‰ˆæœ¬ã€æ—¶é—´æˆ³ã€IDç­‰ï¼‰
  "input": {...},          // è¾“å…¥æ•°æ®ï¼ˆä»»åŠ¡ã€åˆ†å­ã€æ–¹æ³•ï¼‰
  "execution": {...},      // æ‰§è¡Œä¿¡æ¯ï¼ˆçŠ¶æ€ã€æ—¶é—´ã€æ–‡ä»¶ï¼‰
  "raw_results": {...},   // åŸå§‹è®¡ç®—ç»“æœï¼ˆèƒ½é‡ã€å‡ ä½•ã€æ”¶æ•›æ€§ï¼‰
  "analysis": {...},       // AI åˆ†æç»“æœï¼ˆæ€»ç»“ã€è¯„ä¼°ã€å»ºè®®ï¼‰
  "ai_analysis": {...}    // AI æ¨¡å‹å…ƒæ•°æ®
}
```

### è®­ç»ƒæ•°æ®æ ¼å¼ï¼ˆJSONLï¼‰

**ä»»åŠ¡è§„åˆ’è®­ç»ƒ**ï¼š
```jsonl
{"input": "è®¡ç®—æ°´åˆ†å­çš„å•ç‚¹èƒ½", "output": {"task": {...}, "molecule": {...}}}
```

**ç»“æœåˆ†æè®­ç»ƒ**ï¼š
```jsonl
{"input": {"raw_results": {...}}, "output": {"analysis": {...}}}
```

## ğŸ—ï¸ æ¨¡å—ç»“æ„

```
bdfeasyinput/
â”œâ”€â”€ analysis/
â”‚   â”œâ”€â”€ standardizer/      # â­ NEW æ•°æ®æ ‡å‡†åŒ–æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ schema.py     # Schema å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ normalizer.py  # æ•°æ®æ ‡å‡†åŒ–å™¨
â”‚   â”‚   â”œâ”€â”€ validator.py   # æ•°æ®éªŒè¯å™¨
â”‚   â”‚   â””â”€â”€ exporter.py   # æ•°æ®å¯¼å‡ºå™¨
```

## ğŸ“š æ–°å¢æ–‡æ¡£

1. **[DATA_STANDARDIZATION_DESIGN.md](DATA_STANDARDIZATION_DESIGN.md)** - è¯¦ç»†è®¾è®¡æ–‡æ¡£
2. **[examples/data_standardization_example.md](examples/data_standardization_example.md)** - ä½¿ç”¨ç¤ºä¾‹

## ğŸ”§ æŠ€æœ¯å®ç°

### æ ¸å¿ƒä¾èµ–

```txt
jsonschema>=4.0.0      # JSON Schema éªŒè¯
jsonlines>=3.0.0       # JSONL æ–‡ä»¶å¤„ç†
pandas>=1.5.0          # å¯é€‰ï¼šParquet æ ¼å¼
```

### ä½¿ç”¨ç¤ºä¾‹

```python
from bdfeasyinput.analysis.standardizer import AnalysisStandardizer

# æ ‡å‡†åŒ–åˆ†æç»“æœ
standardizer = AnalysisStandardizer()
standardized = standardizer.standardize(
    input_data=input_data,
    execution_result=execution_result,
    raw_results=raw_results,
    analysis_result=analysis_result
)

# å¯¼å‡ºæ ‡å‡†åŒ–æ•°æ®
standardizer.export_json(standardized, "standardized_data.json")

# å‡†å¤‡è®­ç»ƒæ•°æ®
from bdfeasyinput.analysis.standardizer import prepare_planning_training_data

training_data = prepare_planning_training_data([standardized])
standardizer.export_training_data(
    training_data,
    "training_data.jsonl",
    format="jsonl"
)
```

## ğŸ“– ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1ï¼šè‡ªåŠ¨æ ‡å‡†åŒ–

åœ¨åˆ†æç»“æœæ—¶è‡ªåŠ¨ç”Ÿæˆæ ‡å‡†åŒ–æ•°æ®ï¼š

```bash
bdfeasyinput analyze output.out \
  --input input.inp \
  --standardize \
  --output-dir ./standardized_data
```

### åœºæ™¯ 2ï¼šæ‰¹é‡å¤„ç†

æ‰¹é‡æ ‡å‡†åŒ–å†å²è®¡ç®—ç»“æœï¼š

```python
# æ‰¹é‡å¤„ç†å¤šä¸ªç»“æœ
for result in results:
    standardized = standardizer.standardize(**result)
    standardizer.export_json(standardized, f"data/{standardized['metadata']['calculation_id']}.json")
```

### åœºæ™¯ 3ï¼šè®­ç»ƒæ•°æ®å‡†å¤‡

å‡†å¤‡ LLM è®­ç»ƒæ•°æ®ï¼š

```python
# åŠ è½½æ ‡å‡†åŒ–æ•°æ®
data_list = load_standardized_data("data/standardized/")

# å‡†å¤‡è®­ç»ƒæ•°æ®
training_data = prepare_planning_training_data(data_list)

# å¯¼å‡º
standardizer.export_training_data(training_data, "training/planning.jsonl")
```

## ğŸ¯ æ•°æ®è´¨é‡ä¿è¯

### éªŒè¯æœºåˆ¶

- **Schema éªŒè¯**ï¼šç¡®ä¿æ•°æ®ç»“æ„ç¬¦åˆå®šä¹‰
- **æ•°æ®å®Œæ•´æ€§**ï¼šæ£€æŸ¥å¿…éœ€å­—æ®µ
- **æ•°æ®ä¸€è‡´æ€§**ï¼šéªŒè¯æ•°å€¼èŒƒå›´å’Œé€»è¾‘å…³ç³»
- **å•ä½ä¸€è‡´æ€§**ï¼šç¡®ä¿å•ä½ä½¿ç”¨æ­£ç¡®

### æ•°æ®æ¸…æ´—

- ç§»é™¤æ— æ•ˆæ•°æ®
- å¤„ç†ç¼ºå¤±å€¼
- æ ‡å‡†åŒ–æ ¼å¼
- å»é‡å¤„ç†

## ğŸ“ æ•°æ®å­˜å‚¨ç»“æ„

```
data/
â”œâ”€â”€ standardized/          # æ ‡å‡†åŒ–æ•°æ®
â”‚   â”œâ”€â”€ 2024/
â”‚   â”‚   â”œâ”€â”€ 01/
â”‚   â”‚   â”‚   â”œâ”€â”€ calc_001.json
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ ...
â”œâ”€â”€ training/              # è®­ç»ƒæ•°æ®
â”‚   â”œâ”€â”€ planning/
â”‚   â”‚   â””â”€â”€ planning_data.jsonl
â”‚   â”œâ”€â”€ analysis/
â”‚   â”‚   â””â”€â”€ analysis_data.jsonl
â”‚   â””â”€â”€ ...
â””â”€â”€ schemas/               # Schema å®šä¹‰
    â””â”€â”€ analysis_result_schema.json
```

## ğŸš€ å¼€å‘è®¡åˆ’

### Phase 1: åŸºç¡€æ ‡å‡†åŒ–ï¼ˆ2-3 å‘¨ï¼‰
- [ ] å®šä¹‰æ•°æ® Schema
- [ ] å®ç°æ ‡å‡†åŒ–å™¨
- [ ] å®ç°éªŒè¯å™¨
- [ ] åŸºç¡€å¯¼å‡ºåŠŸèƒ½

### Phase 2: è®­ç»ƒæ•°æ®å‡†å¤‡ï¼ˆ2-3 å‘¨ï¼‰
- [ ] è®­ç»ƒæ•°æ®æ ¼å¼è®¾è®¡
- [ ] æ•°æ®æå–å’Œè½¬æ¢
- [ ] æ‰¹é‡å¤„ç†åŠŸèƒ½
- [ ] æ•°æ®ç´¢å¼•ç³»ç»Ÿ

### Phase 3: æ•°æ®ç®¡ç†ï¼ˆ2-3 å‘¨ï¼‰
- [ ] æ•°æ®å­˜å‚¨ç³»ç»Ÿ
- [ ] æ•°æ®æŸ¥è¯¢å’Œæ£€ç´¢
- [ ] æ•°æ®ç»Ÿè®¡å’Œåˆ†æ
- [ ] æ•°æ®è´¨é‡ç›‘æ§

## ğŸ’¡ åº”ç”¨ä»·å€¼

### 1. LLM æ¨¡å‹è®­ç»ƒ

- **é«˜è´¨é‡æ•°æ®**ï¼šæ ‡å‡†åŒ–çš„è¾“å…¥-è¾“å‡ºå¯¹
- **å¤§è§„æ¨¡æ•°æ®**ï¼šæ”¯æŒæ‰¹é‡å¤„ç†å’Œç§¯ç´¯
- **å¤šæ ·åŒ–åœºæ™¯**ï¼šè¦†ç›–å„ç§è®¡ç®—ç±»å‹å’Œæ–¹æ³•

### 2. çŸ¥è¯†åº“æ„å»º

- **ç»“æ„åŒ–å­˜å‚¨**ï¼šä¾¿äºæŸ¥è¯¢å’Œæ£€ç´¢
- **çŸ¥è¯†ç§¯ç´¯**ï¼šé•¿æœŸç§¯ç´¯è®¡ç®—ç»“æœ
- **ç»éªŒå¤ç”¨**ï¼šåŸºäºå†å²æ•°æ®ä¼˜åŒ–

### 3. ç»“æœå¯¹æ¯”åˆ†æ

- **ç»Ÿä¸€æ ¼å¼**ï¼šä¾¿äºå¯¹æ¯”ä¸åŒè®¡ç®—ç»“æœ
- **ç»Ÿè®¡åˆ†æ**ï¼šå‘ç°è®¡ç®—è§„å¾‹å’Œè¶‹åŠ¿
- **è´¨é‡è¯„ä¼°**ï¼šè¯„ä¼°æ–¹æ³•å’ŒåŸºç»„æ•ˆæœ

## ğŸ“Œ æ³¨æ„äº‹é¡¹

1. **æ•°æ®éšç§**ï¼šæ ‡å‡†åŒ–æ•°æ®å¯èƒ½åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼Œæ³¨æ„æ•°æ®å®‰å…¨
2. **æ•°æ®è´¨é‡**ï¼šç¡®ä¿æ ‡å‡†åŒ–æ•°æ®çš„å‡†ç¡®æ€§å’Œå®Œæ•´æ€§
3. **ç‰ˆæœ¬ç®¡ç†**ï¼šSchema ç‰ˆæœ¬ç®¡ç†ï¼Œç¡®ä¿å‘åå…¼å®¹
4. **å­˜å‚¨ç©ºé—´**ï¼šå¤§è§„æ¨¡æ•°æ®éœ€è¦åˆç†çš„å­˜å‚¨ç­–ç•¥

---

**æ•°æ®æ ‡å‡†åŒ–åŠŸèƒ½å°†ä¸ºæœªæ¥çš„ LLM æ¨¡å‹è®­ç»ƒæä¾›é«˜è´¨é‡çš„æ•°æ®åŸºç¡€ï¼** ğŸ‰

