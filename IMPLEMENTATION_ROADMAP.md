# BDFEasyInput 实施路线图

## 项目目标回顾

将 BDF 量子化学软件的输入从"专家模式"简化为"用户友好模式"，通过自动转换工具实现。**新增 AI 功能**：支持自然语言输入，AI 自动规划计算任务并生成输入。

## 关键设计决策

### 1. 输入格式选择

**推荐：YAML 格式**
- ✅ 人类可读性强
- ✅ 支持注释
- ✅ 层次结构清晰
- ✅ 广泛使用的配置文件格式

**备选：JSON 格式**
- ✅ 程序友好
- ✅ 标准化格式
- ❌ 不支持注释
- ❌ 可读性较差

**备选：命令行参数**
- ✅ 简单任务快速执行
- ❌ 复杂任务难以表达
- ❌ 不适合复杂分子

**决策**：主要支持 YAML，同时提供 JSON 和 CLI 选项。

### 2. 技术栈选择

**核心语言**：Python 3.8+
- 丰富的科学计算生态
- 易于开发和维护
- 良好的社区支持

**关键库**：
- `pydantic`：数据验证和模型定义
- `pyyaml`：YAML 解析
- `jinja2`：模板引擎
- `click`：命令行界面
- **AI 库**（可选）：
  - `ollama`：本地模型支持
  - `openai`：OpenAI API 支持
  - `anthropic`：Anthropic API 支持

### 3. 架构模式

**分层架构**：
1. **AI 规划层**（新增）：自然语言理解、任务规划、YAML 生成
2. 输入解析层
3. 验证层
4. 转换层
5. 生成层

**优点**：
- 清晰的职责分离
- 易于测试和维护
- 便于扩展

## 实施阶段

### 阶段 0：准备工作 ✅

- [x] 项目规划文档
- [x] 架构设计
- [x] AI 模块设计 ⭐ NEW
- [x] 目录结构创建
- [x] 基础配置文件

### 阶段 1：最小可行产品 (MVP) - 2-3 周

**目标**：实现一个可以工作的原型

**任务清单**：
1. **基础框架**
   - [ ] 创建核心包结构
   - [ ] 实现基础数据模型（使用 Pydantic）
   - [ ] 设置日志系统

2. **YAML 解析器**
   - [ ] 实现 YAML 文件读取
   - [ ] 解析基本结构（任务、分子、方法）
   - [ ] 错误处理

3. **简单验证器**
   - [ ] Schema 验证
   - [ ] 基本参数检查

4. **基础转换器**
   - [ ] 方法名称映射（至少支持 HF 和一种 DFT）
   - [ ] 基组名称映射（至少支持 1-2 种基组）
   - [ ] 分子结构转换

5. **模板生成器**
   - [ ] 创建基础 BDF 输入模板
   - [ ] 实现模板渲染
   - [ ] 生成输出文件

6. **命令行接口**
   - [ ] 基本 CLI 实现
   - [ ] 帮助信息

**验收标准**：
- 能够解析简单的 YAML 输入
- 能够生成基本的 BDF 输入文件
- 至少支持一种计算类型（单点能）

### 阶段 2：核心功能完善 - 4-6 周

**目标**：支持常用的计算场景

**任务清单**：
1. **扩展输入格式支持**
   - [ ] JSON 解析器
   - [ ] 从 XYZ 文件读取分子结构
   - [ ] 命令行参数解析

2. **计算方法扩展**
   - [ ] 支持更多 DFT 泛函（PBE, B3LYP, PBE0 等）
   - [ ] Hartree-Fock 方法完善
   - [ ] 基组库扩展（至少 10 种常用基组）

3. **计算类型扩展**
   - [ ] 几何优化
   - [ ] 频率计算
   - [ ] 过渡态搜索（可选）

4. **验证系统完善**
   - [ ] 参数兼容性检查
   - [ ] 电荷/自旋验证
   - [ ] 详细的错误消息

5. **模板系统增强**
   - [ ] 多种计算类型的模板
   - [ ] 条件渲染
   - [ ] 模板变量系统

6. **测试覆盖**
   - [ ] 单元测试（目标覆盖率 > 80%）
   - [ ] 集成测试
   - [ ] 示例文件测试

7. **AI 模块基础实现** ⭐ NEW
   - [ ] AI 客户端接口设计
   - [ ] Ollama 客户端实现
   - [ ] OpenAI 客户端实现（可选）
   - [ ] 基础提示词模板
   - [ ] 简单的任务规划器原型

**验收标准**：
- 支持至少 5 种 DFT 泛函
- 支持至少 10 种基组
- 支持单点能、几何优化、频率计算
- 测试覆盖率 > 80%
- AI 模块可以连接本地或远程模型（基础功能）

### 阶段 3：用户体验优化 + AI 功能完善 - 4-5 周

**目标**：提高易用性和健壮性，完善 AI 功能

**任务清单**：
1. **错误处理改进**
   - [ ] 友好的错误消息
   - [ ] 错误修复建议
   - [ ] 详细的日志系统

2. **文档完善**
   - [ ] 用户指南
   - [ ] API 文档
   - [ ] 更多示例
   - [ ] AI 功能使用文档 ⭐ NEW

3. **功能增强**
   - [ ] 输入文件验证（运行前检查）
   - [ ] 参数提示和自动补全
   - [ ] 默认值智能填充

4. **性能优化**
   - [ ] 大分子处理优化
   - [ ] 模板渲染优化
   - [ ] 内存使用优化

5. **扩展性改进**
   - [ ] 插件系统设计
   - [ ] 配置系统完善
   - [ ] 自定义模板支持

6. **AI 功能完善** ⭐ NEW
   - [ ] 完整的任务规划器实现
   - [ ] YAML 生成和验证
   - [ ] 交互式对话功能
   - [ ] 方法推荐器
   - [ ] 提示词优化
   - [ ] AI 输出验证和错误处理
   - [ ] 支持 Anthropic Claude（可选）

**验收标准**：
- 完整的用户文档
- 友好的错误消息
- 性能满足大型分子处理需求
- AI 功能可以完整规划任务并生成有效的 YAML ⭐ NEW

### 阶段 4：高级功能和集成 - 3-4 周（可选）

**目标**：扩展功能和生态系统集成

**任务清单**：
1. **高级计算类型**
   - [ ] 激发态计算
   - [ ] 响应性质
   - [ ] 分子动力学（如果 BDF 支持）

2. **工作流集成**
   - [ ] 与常见工作流工具集成
   - [ ] 批量处理支持
   - [ ] 参数扫描工具

3. **后处理功能**
   - [ ] 结果解析
   - [ ] 数据提取
   - [ ] 可视化辅助

4. **GUI 界面**（长期目标）
   - [ ] 图形用户界面设计
   - [ ] Web 界面（可选）

## 关键里程碑

- **M1（3 周后）**：MVP 完成，可以处理简单的单点能计算
- **M2（8 周后）**：核心功能完成，支持常用计算场景；AI 模块基础功能可用
- **M3（13 周后）**：用户体验优化完成，AI 功能完善，准备 beta 发布 ⭐ 更新
- **M4（17 周后）**：高级功能完成，准备正式发布 ⭐ 更新

## 风险和挑战

### 技术风险

1. **BDF 输入格式复杂性**
   - 风险：BDF 的输入格式可能比预期复杂
   - 缓解：早期深入了解 BDF 输入格式，建立映射表

2. **方法/基组映射的准确性**
   - 风险：映射关系可能不完整或不准确
   - 缓解：与 BDF 开发团队协作，建立测试套件

3. **性能问题**
   - 风险：大型分子的处理可能较慢
   - 缓解：性能测试，优化关键路径

### 项目风险

1. **需求变化**
   - 风险：用户需求可能在开发过程中变化
   - 缓解：采用迭代开发，早期收集反馈

2. **文档和示例不足**
   - 风险：用户可能不知道如何使用
   - 缓解：重视文档，提供丰富的示例

## 成功标准

1. **功能性**
   - 能够处理 90% 的常见计算任务
   - 生成的输入文件与手写输入等价

2. **易用性**
   - 新用户能在 30 分钟内完成第一个计算
   - 输入文件比 BDF 原生输入简洁 50% 以上

3. **可靠性**
   - 测试覆盖率 > 80%
   - 生成的输入文件通过 BDF 验证

4. **可维护性**
   - 代码结构清晰，文档完整
   - 易于添加新功能

## 下一步行动

1. **立即开始**：
   - 深入了解 BDF 输入格式
   - 收集 BDF 输入文件示例
   - 建立方法/基组映射表

2. **第一周任务**：
   - 搭建开发环境
   - 实现基础数据模型
   - 创建第一个解析器原型

3. **获取反馈**：
   - 与 BDF 用户讨论输入格式设计
   - 收集实际使用场景
   - 调整设计方案

## 资源需求

1. **人员**：
   - 1-2 名开发人员
   - BDF 专家咨询（按需）

2. **时间**：
   - MVP：2-3 周
   - 完整功能：12-16 周

3. **其他**：
   - BDF 软件访问权限
   - BDF 文档和示例
   - 测试用例

